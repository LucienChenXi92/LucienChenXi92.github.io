---
title: "[ACP考试] - 阿里云对象存储OSS"
catalog: true
date: 2020-09-13 05:20:24
subtitle: ""
header-img: "/img/default.png"
tags:
- 阿里云
catagories:
---

#### 对象存储的概念

##### 阿里云存储产品

+ 块存储：阿里云为云服务器ECS提供的块设备，具有高性能和低延迟的特点，支持随机读写，可以作为系统盘或是数据盘直接挂载在ECS实例上。
+ 文件存储NAS：适合存储非结构化的海量数据。需要通过标准的文件访问协议访问这些数据。Linux系统需要使用NFS协议，Windows系统需要使用SMB，又称为CIFS协议。类似于Window企业级文件共享的方式。
+ 对象存储OSS：一个海量的存储空间，适合存储互联网上产生额图片、短视频、音频等海量非结构化数据。可以通过API在任何时间、任何地点访问对象存储的数据。

##### 对象的概念

对象是OSS存储数据的基本单元，也被称为OSS的文件。对象由元信息(Metadata)、用户数据(Data)、和文件名(Key)组成。对象由存储空间内部唯一的Key来标识。对象元信息是是一组键值对，表示了对象的一些属性，比如最后修改时间、大小等信息，同时也在元信息中定义了一些属性。

##### 阿里云对象存储OSS

+ 阿里云对象存储服务(Object Storage Service，简称OSS)，是阿里云提供的海量、安全、低成本、高可靠的云存储服务。其数据持久性不低于99.99...(12个9)，服务设计可用性不低于99.995。
+ OSS具有与平台无关的RESTful API接口，可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。
+ 可以使用阿里云提供的API、SDK接口或是OSS迁移工具轻松地将海量数据移入或移出阿里云OSS。

##### OSS的优势

+ 方便、快捷的使用方式
+ 强大、灵活的安全机制
+ 数据冗余机制
+ 丰富、强大的增值服务

##### 存储空间(Bucket)

存储空间是用户用于存储对象(Object)的容器，所有的对象都必须隶属于某个存储空间。存储空间具有各种配置属性，包括地域、访问权限、存储类型等。用户可以根据实际需求，创建不同类型的存储空间来存储不同的数据。
+ 同一个存储空间内部是扁平的，没有文件系统的目录等概念，搜有对象直接隶属于其对应的存储空间。
+ 每个用户可以拥有多个存储空间。
+ 存储空间的名称在OSS范围内必须全局唯一，一旦创建不可修改。
+ 存储空间内部的对象数量没有限制。

> 存储空间命名规范：
> + 只能包括消息字母、数字和短横线(-)。
> + 必须一小写字母或者数字开头和结尾。
> + 长度必须在3 - 63字节之间。

##### 对象/文件(Object)

对象是OSS存储数据的基本单元，也被称为OSS的文件。对象由元信息(Metadata)、用户数据(Data)、和文件名(Key)组成。对象的生命周期是从上传到删除为止。整个生命周期内，只有通过追加上传的Object可以继续通过追加上传写入数据，其他上传的Object内容无法编辑，可以通过重复上传同名的对象来覆盖之前的对象。

> 对象命名规范：
> + 使用UTF-8编码。
> + 长度必须在1-1023个字符之间。
> + 不能以正斜杠或反斜杠开头。

##### 其他概念

+ Region(地域)
+ Endpoint(访问域名)
+ AccessKey(访问秘钥)
+ 强一致性
+ 数据冗余机制

##### OSS对比文件系统

|对比项|OSS|文件系统|
|--|--|--|
|数据模型|OSS是Hash索引|文件系统是典型的树状索引结构|
|数据获取|根据key获取内容|先访问目录，然后再逐级查找文件|
|优势|支持海量的用户并发访问|支持文件修改|
|劣势|OSS保存Object不支持修改|受限于单个设备的性能限制。|

##### 对象存储OSS的存储类型

+ 标准存储类型
+ 低频访问存储类型
+ 归档存储类型

> 低频访问存储类型最少存储时间为30天，归档类型存储至少60天。归档类型数据取回需要先解冻，大约一分钟延迟，解冻的数据要按GB为单位来收费。

#### 阿里云对象存储的使用

##### OSS管理流程

开通OSS服务 -> 创建存储空间 -> 上传文件 -> 下载文件 -> 删除文件 -> 删除存储空间

##### 创建存储空间流程

Bucket名称 -> Region -> Endpoint -> 存储类型 -> 授权类型 -> 加密 -> 日志 -> 开通

##### 存储空间的读写权限

+ 私有
+ 公共读
+ 公共读写

##### Bucket Policy授权其他用户访问OSS资源

登录OSS管理控制台 -> 在存储空间列表中 -> 单击存储空间概览页面 -> 单击文件管理 -> 在授权页面单击新增授权 -> 在新增页面设置项目 -> 单击确定

+ 当前账号：可以从下拉菜单中选择当前账号的子账号，授予Bucket访问权限。账号必须是主账号，或拥有此Bucket管理权限以及RAM控制台ListUsurs权限的子账号。
+ 其他账号：当需要给其他账号授予Bucket访问权限，或账号无ListUsers权限时，请直接收入授权账号的UID。
+ 匿名账号：或需要给所有用户授权，可以选择匿名账号(*)。

##### 控制台下载Object

在该存储空间概览页面中，单击文件管理也签，然后通过一下方式下载文件：
+ 下载一个或多个文件，选中一个或多个文件，选择批量操作 > 下载。
+ 下载单一文件，单击文件的文件名或其右侧的详情，在打开的详情页面中单击下载。
+ 要下载单个文件，还可以选择目标文件右侧的更多 > 下载。
+ 要在浏览器里通过打开URL的方式直接下载文件，单击文件的文件名或其右侧的详情，在打开的详情页面中单击打开URL。

##### 获取文件的URL

其他访问者进行下载需要获取文件的URL，单击目标文件的文件名或其右侧的详情，在打开的详情页面中单击复制URL。

##### 删除OSS文件

登录OSS控制台 -> 在左侧存储空间列表中，单击目标存储空间名称 -> 在该存储空间概览页面中，单击文件管理页 -> 选择一个或多个文件，选择批量操作 > 删除 -> 在删除文件对话框中，单击确定。

> 批量删除一次性最多选择1000个。

##### 防盗链

对象存储OSS是按照使用量收费的服务，为了减少存储于OSS的数据被其他人盗链而产生额外费用，OSS支持设置基于HTTP和HTTPS header中标投资端Referer的防盗链方法。可以通过控制台中为存储空间设置Referer字段的白名单以控制请求访问。

##### 声明周期规则

为方便管理存储空间的资源，OSS提供了生命周期规则。可以通过生命周期规则来批量转换Bucket内的对象的存储类型，也可以批量删除指定的Object和碎片。 

##### OSS之间的数据迁移

使用阿里云在线迁移服务可以在阿里云存储OSS之间进行`跨账号、跨地域、以及同地域内`的数据迁移。

使用在线迁移服务，只需在控制台填写源数据地址和目标OSS地址信息，并创建迁移任务即可。启动迁移后，可以通过控制台管理迁移任务，查看进度，流量等信息。也可以生成迁移报告，查看迁移文件列表，错误文件列表。

##### 数据库备份到OSS

通过数据库备份DBS将本地IDC、公网、第三方云数据库、阿里云RDS和阿里云ECS自建数据库实时备份到OSS上。

#### 对象存储OSS的计费和限制

##### 计费方式

+ 按量付费：使用量 * 单价的方式，按小时收费
+ 报年包月：三种存储类型价格不同

##### 费用构成

+ 存储费用
    + 标准存储：按照实际存储时间和空间计费
    + 低频存储：存储时间最少30天，文件大小最小64k，少于64k按照64k计算。
    + 归档存储：存储时间最少60天，文件大小最小64k，少于64k按照64k计算。
+ 流量费用
    + 外网流出流量：通过互联网从OSS下载到本地的流量费用。
    + CDN回源流量：通过CDN服务下载OSS资源的费用。
    + 跨区域复制流量：将源Bucket同步到目标Bucket上花费的流量费用。
+ 请求费用
    + 请求次数：按小时请求数量计费。
+ 数据处理
    + 图片处理：按图片大小计费。
    + 视频戳帧：按截取数量计费。
    + Select扫描：扫描数据量大小计费。
    + 数据取回：低频存储类型和归档存储类型数据需要额外费用。

##### OSS使用限制

+ 归档存储：需要一分钟解冻时间。
+ 存储空间：存储空间同一账号、同一地域下总Bucket数量不可超过30个，存储空间名称不可重复，一旦创建成功，其名称、地域、存储类型不能修改。单个存储空间容量没有上限。
+ 上传下载：通过控制台上传、简单上传、表单上传、追加上传的文件大小不能超过`5G`，要上传更大的文件必须使用`断点续传`的方式。断点续传的方式上传的文件大小最大不能超过`48.8TB`。同一个账号在同一地域上传或下载带宽缺省阈值：中国大陆10G/s，其他地区5G/s。OSS支持上传同名文件，但会覆盖已有文件。
+ 删除文件：文件删除后无法恢复，控制台批量操作上线1000个，更大的批量操作必须通过API或SDK实现。
+ 域名绑定：账号必须在阿里云官网完成实名认证。中国大陆地域绑定的域名必须在工信部备案，其他地域的域名绑定不需要在工信部备案。每个存储空间最多可以绑定100个域名。
+ 生命周期：每个存储空间的生命周期配置最多1000条规则。
+ 图片处理：对于原图，文件格式：jpg，png，bmp，gif，webp，tiff。文件大小不能超过20MB。
+ 资源包：全国通用只能在中国大陆使用。